# Kalman-Filter
確率ロボティクスの課題でカルマンフィルタを実装した．

以下にカルマンフィルタのアルゴリズムとプログラムの詳細を記載する．

## デモ動画
動作するロボットを位置の一次元問題とし真値，観測地，補正値を以下の色で可視化した．

🟢真値

🔴観測値

🔵観測値からカルマンフィルタを使った補正値

https://github.com/user-attachments/assets/b746d174-4854-4c29-a87d-c329235ae9f1


## アルゴリズム
カルマンフィルタとはノイズが混在するデータから真値を推定するアルゴリズムである．

カルマンフィルタは次のプロセスで実装される．

1. ロボットの状態方程式を定義

1. センサモデルを考慮した観測方程式を定義

1. モデルの不確かさからなる状態方程式のノイズやセンサ誤差による観測方程式のノイズを定義

1. 状態方程式から次の時刻の状態を予測

1. 予測誤差分散を用いてカルマンゲインを計算

1. センサからの情報で予測値を修正

1. ロボットの状態と誤差分散を更新


### 状態方程式
動作するロボットは等速で一方向のみに移動すると仮定した時の状態方程式は以下ようになる．

$$
x_k = x_{k-1} + u + w_k
$$

$$
x_k：時刻kの真値（位置）
$$

$$
u：1ステップあたりの移動量
$$


$$
w_k：ノイズ
$$


### 観測方程式
センサの観測する位置とセンサ誤差が一次元の観測方程式となる．

$$
z_k = x_k + v_k
$$

$$
z_k：観測値
$$

$$
v_k：観測ノイズ
$$

### 推定誤差分散
推定した値の不確かさを誤差分散で表し，正規分布に準ずるものとする．

$$
P_k = \mathrm{Var}(x_k - \hat{x}_k)
$$

$$
P：推定誤差分布
$$

$$
\hat{x}_k：推定値
$$

### 予測ステップ
状態方程式から次の状態を予測

$$
\hat{x}_{k|k-1} = \hat{x}_{k-1} + u
$$

$$
\hat{x}_{k|k-1}：時刻kにおける予測された状態
$$

$$
\hat{x}_{k-1}：時刻k-1における推定状態
$$

$$
u：入力量
$$

### 分散予測
前の時刻の不確かさとモデル誤差を足し合わせたもの

$$
P_{k|k-1} = P_{k-1} + Q
$$

$$
P_{k|k-1}：時刻kにおける予測後と予測前の誤差分散
$$

$$
P_{k-1} ：時刻k-1における更新後の誤差分散
$$

$$
Q：モデルノイズの分散
$$


### カルマンゲイン

$$
K_k = \frac{P_{k|k-1}}{P_{k|k-1} + R}
$$


### 更新ステップ


$$
\hat{x}_k= \hat{x}_{k|k-1}+ K_k \left( z_k - \hat{x}_{k|k-1} \right)
$$



$$
P_k = (1 - K_k) P_{k|k-1}
$$

## 開発言語
C++

## デバック環境
VisualStadio 2022

## 動作確認環境
ubuntu22.04

## 使用ライブラリ
OpenCV



